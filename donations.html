<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>MXHVN • Đang điều hướng…</title>

  <link rel="prefetch" href="/vn/" as="document" />

  <style>
    :root{
      --bg:#0b1220;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.48);
      --primary:#4f46e5;
      --good:#22c55e;

      --cta:#ff6a2a;
      --cta2:#ff7c44;

      --shadow: 0 24px 70px rgba(0,0,0,.45);
      --radius: 18px;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f7fb;
        --card:rgba(0,0,0,.04);
        --stroke:rgba(0,0,0,.08);
        --text:rgba(0,0,0,.88);
        --muted:rgba(0,0,0,.58);
        --muted2:rgba(0,0,0,.42);
        --shadow: 0 18px 60px rgba(0,0,0,.12);
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg);
      color:var(--text);
    }

    .wrap{
      height:100%;
      display:grid;
      place-items:center;
      padding:18px;
    }

    .grid{
      width:min(1080px, 100%);
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--stroke);
      background: var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    .header{
      padding:18px 18px 10px 18px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .mark{
      width:40px;height:40px;border-radius:14px;
      background: linear-gradient(135deg, rgba(79,70,229,.95), rgba(59,130,246,.85));
      box-shadow: 0 16px 40px rgba(79,70,229,.25);
      position:relative;
      flex:0 0 auto;
    }
    .mark:after{
      content:"";
      position:absolute; inset:1px;
      border-radius:13px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
    }
    @media (prefers-color-scheme: light){
      .mark:after{ background: rgba(255,255,255,.55); border-color: rgba(0,0,0,.06); }
    }

    h1{ margin:0; font-size:16px; letter-spacing:.2px; }
    .sub{ margin:4px 0 0 0; font-size:13px; color:var(--muted); line-height:1.35; }

    .body{ padding: 10px 18px 18px 18px; }

    /* ===== Left CTA (replaces redirect info) ===== */
    .ctaBox{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      border-radius: 16px;
      padding: 16px;
    }
    @media (prefers-color-scheme: light){
      .ctaBox{ background: rgba(0,0,0,.02); }
    }
    .ctaTitle{
      font-size: 18px;
      font-weight: 1000;
      letter-spacing: .2px;
      margin: 0;
    }
    .ctaText{
      margin: 8px 0 0 0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.55;
    }

    .ctaBtnRow{
      margin-top: 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .ctaBtn{
      width:100%;
      appearance:none;
      border:0;
      border-radius:999px;
      padding: 13px 16px;
      font-weight:1000;
      font-size:14px;
      cursor:pointer;
      color:#fff;
      background: linear-gradient(135deg, var(--cta), var(--cta2));
      box-shadow: 0 18px 45px rgba(255,106,42,.18);
      transition: transform .08s ease, opacity .2s ease, filter .2s ease;
    }
    .ctaBtn:active{ transform: translateY(1px); }
    .ctaBtn[disabled]{ opacity:.75; cursor:not-allowed; }

    .hintRow{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      color: var(--muted2);
    }

    .progress{
      margin-top: 12px;
      height: 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(255,106,42,.95), rgba(255,124,68,.90));
      transition: width .15s ease;
    }

    .pausedBadge{
      display:none;
      margin-top: 10px;
      border:1px solid rgba(34,197,94,.35);
      background: rgba(34,197,94,.10);
      color: rgba(255,255,255,.92);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 12px;
      font-weight: 900;
    }
    @media (prefers-color-scheme: light){
      .pausedBadge{ color: rgba(0,0,0,.82); }
    }
    .is-paused .pausedBadge{ display:block; }

    .foot{
      padding: 0 18px 16px 18px;
      font-size:12px;
      color: var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    /* ===== Donate panel (keep as-is) ===== */
    .donateTop{
      padding:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--stroke);
    }
    .donateTop strong{ font-size:14px; }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      color:var(--muted);
      background: rgba(255,255,255,.04);
      white-space:nowrap;
    }
    .donateBody{ padding:14px; }

    .banner{
      width:100%;
      border-radius:14px;
      border:1px solid var(--stroke);
      overflow:hidden;
      background: rgba(255,255,255,.03);
    }
    .banner img{ width:100%; display:block; }

    .miniRow{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      font-size:12px;
      color:var(--muted);
      gap:10px;
    }
    .tinybar{
      margin-top:8px;
      height:10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      overflow:hidden;
    }
    .tinyfill{
      height:100%;
      width:11%;
      background: var(--good);
      border-radius:999px;
    }

    .feed{
      margin-top:14px;
      border-top:1px solid var(--stroke);
      padding-top:12px;
    }
    .feed h3{
      margin:0 0 10px 0;
      font-size:13px;
      color:var(--muted);
      font-weight:800;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .item{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 10px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      border-radius:14px;
      margin-bottom:10px;
      align-items:flex-start;
    }
    .who{ font-weight:800; color:var(--text); font-size:13px; }
    .when{ color:var(--muted2); font-size:12px; margin-top:2px; }
    .msg{ color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35; }
    .amt{ font-weight:900; color:var(--text); white-space:nowrap; font-size:12px; }

    /* Social proof add-ons */
    .proofGrid{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    @media (max-width: 980px){
      .proofGrid{ grid-template-columns: 1fr; }
    }
    .proofBox{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding: 10px 10px;
    }
    .proofK{ font-size:11px; color:var(--muted2); font-weight:800; letter-spacing:.2px; }
    .proofV{ font-size:16px; font-weight:1000; margin-top:6px; }
    .proofS{ font-size:11px; color:var(--muted); margin-top:2px; }

    .board{
      margin-top:12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.02);
      border-radius: 14px;
      padding: 12px;
    }
    .boardHead{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:10px;
    }
    .boardHead strong{ font-size:13px; }
    .boardList{ display:grid; gap:8px; }

    .boardItem{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 10px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
    }
    .leftPack{ display:flex; align-items:center; gap:10px; min-width:0; }
    .avatar{
      width:34px; height:34px;
      border-radius: 12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      display:grid;
      place-items:center;
      font-weight:1000;
      font-size:12px;
      color: var(--text);
      flex:0 0 auto;
    }
    .nameBlock{ min-width:0; }
    .nameLine{
      font-weight:900; font-size:13px;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
    .subLine{ font-size:11px; color:var(--muted2); margin-top:2px; }
    .amount{ font-weight:1000; white-space:nowrap; }

    .moreRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-top: 6px;
    }
    .mutedTxt{ font-size:11px; color:var(--muted2); }

    /* Live toast */
    .toast{
      position: sticky;
      bottom: 12px;
      margin: 0 12px 12px 12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      border-radius: 999px;
      padding: 10px 12px;
      display:flex;
      align-items:center;
      gap:10px;
      opacity:0;
      transform: translateY(6px);
      transition: opacity .25s ease, transform .25s ease;
      backdrop-filter: blur(10px);
    }
    .toast.show{ opacity:1; transform: translateY(0); }
    .toastDot{
      width:10px; height:10px; border-radius:999px;
      background: var(--good);
      box-shadow: 0 0 0 6px rgba(34,197,94,.14);
      flex:0 0 auto;
    }
    .toastTxt{
      font-size:12px;
      color: var(--text);
      font-weight:800;
      overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="grid">

      <!-- LEFT: CTA + forced wait 30s -->
      <section class="card" id="leftCard" aria-label="Support Gate">
        <div class="header">
          <div class="mark" aria-hidden="true"></div>
          <div>
            <h1>Help keep the website ad-free</h1>
            <p class="sub">Nếu bạn muốn ủng hộ, bấm nút bên dưới để ở lại trang này.</p>
          </div>
        </div>

        <div class="body">
          <div class="ctaBox">
            <p class="ctaTitle">Please consider buying us a coffee ☕</p>
            <p class="ctaText">
              Website hoạt động không quảng cáo và được duy trì bởi cộng đồng.
              Nếu bạn bấm “Buy me a coffee”, trang sẽ <b>tạm ngưng chuyển hướng</b> để bạn ủng hộ.
            </p>

            <div class="ctaBtnRow">
              <button class="ctaBtn" id="buyCoffee">Buy me a coffee</button>
            </div>

            <div class="hintRow" aria-hidden="true">
              <span>Auto continue after a short wait</span>
              <span>Loading…</span>
            </div>

            <div class="progress" aria-label="Loading">
              <div class="bar" id="bar"></div>
            </div>

            <div class="pausedBadge" id="pausedBadge">
              ✅ Đã tạm ngưng chuyển hướng. Bạn có thể tiếp tục ủng hộ tại trang MXHVN.
            </div>
          </div>
        </div>

        <div class="foot">
          <div>MXHVN</div>
          <div id="ts"></div>
        </div>
      </section>

      <!-- RIGHT: Donate (keep seeding) -->
      <aside class="card" aria-label="Donate">
        <div class="donateTop">
          <strong>Give support</strong>
          <span class="pill" id="proofPill">Live</span>
        </div>

        <div class="donateBody">
          <div class="banner">
            <img src="./donate-banner.png" alt="Donate banner" />
          </div>

          <div class="proofGrid" aria-label="Social proof counters">
            <div class="proofBox">
              <div class="proofK">Supporters</div>
              <div class="proofV" id="cntSupporters">—</div>
              <div class="proofS">last 30 days</div>
            </div>
            <div class="proofBox">
              <div class="proofK">Tips this week</div>
              <div class="proofV" id="cntWeek">—</div>
              <div class="proofS">rolling 7 days</div>
            </div>
            <div class="proofBox">
              <div class="proofK">Total raised</div>
              <div class="proofV" id="cntRaised">—</div>
              <div class="proofS">community funded</div>
            </div>
          </div>

          <div class="miniRow">
            <span id="expenseTitle">Server expenses for March 2026</span>
            <span><b id="goalPct">11%</b> of goal</span>
          </div>
          <div class="tinybar">
            <div class="tinyfill" id="goalFill" style="width:11%"></div>
          </div>

          <div class="board" aria-label="Top supporters">
            <div class="boardHead">
              <strong>Top supporters</strong>
              <span class="pill" id="boardHint">This month</span>
            </div>
            <div class="boardList" id="boardList"></div>
          </div>

          <div class="feed" aria-label="Recent support">
            <h3>
              <span>Recent supporters</span>
              <span class="pill" id="feedHint">Updated</span>
            </h3>
            <div id="feedList"></div>

            <div class="moreRow">
              <span class="mutedTxt">Showing latest activity</span>
              <span class="mutedTxt" id="lastUpdate">—</span>
            </div>
          </div>
        </div>

        <div class="toast" id="toast" aria-live="polite" aria-atomic="true">
          <div class="toastDot"></div>
          <div class="toastTxt" id="toastTxt">—</div>
        </div>
      </aside>

    </div>
  </div>

<script>
/* ===== Gate Redirect (30s, pause if donate clicked) ===== */
(() => {
  const WAIT_MS = 30_000;
  const DEFAULT = "/vn/";
  const url = new URL(location.href);

  // Preserve deep-link: /abc?x#y -> /vn/abc?x#y (but / -> /vn/)
  const path = (url.pathname === "/" ? "" : url.pathname);
  // const resolved = DEFAULT.replace(/\/+$/,"/") + path.replace(/^\/+/,"") + url.search + url.hash;
  const resolved = "/vn/";
  const bar = document.getElementById("bar");
  const ts  = document.getElementById("ts");
  const buy = document.getElementById("buyCoffee");
  const leftCard = document.getElementById("leftCard");

  try { if (ts) ts.textContent = new Date().toLocaleString("vi-VN"); } catch(e){}

  let start = performance.now();
  let paused = false;
  let done = false;

  // If user clicked donate => pause redirect and keep them on mxhvn.github.io
  const pause = () => {
    if (paused || done) return;
    paused = true;

    if (leftCard) leftCard.classList.add("is-paused");
    if (buy) buy.disabled = true;

    // Optional: make progress bar look "paused"
    if (bar) bar.style.width = "100%";
  };

  if (buy) buy.addEventListener("click", pause);

  const go = () => {
    if (done || paused) return;
    done = true;
    location.replace(resolved);
  };

  const tick = (now) => {
    if (done || paused) return;

    const elapsed = now - start;
    const p = Math.min(1, elapsed / WAIT_MS);
    if (bar) bar.style.width = (p * 100).toFixed(0) + "%";

    if (elapsed >= WAIT_MS) return go();
    requestAnimationFrame(tick);
  };

  requestAnimationFrame(tick);

  // Fallback in case rAF throttled
  setTimeout(go, WAIT_MS + 300);
})();

/* ===== Social Proof Engine (VND, Ko-fi style) ===== */
(() => {
  const $ = (id) => document.getElementById(id);
  const rand = (a, b) => Math.floor(Math.random() * (b - a + 1)) + a;
  const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

  const fmtVND = (n) => {
    const s = Math.round(n).toString();
    return `${s.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} VND`;
  };

  const NAMES = [
    "Somebody","Raghu","Omar","HEUSC","Bori","RC","AB","Linh","Huy","Mai","Minh",
    "Khanh","Thao","Dung","Phuc","An","Vy","Quang","Tuan","Trang"
  ];
  const MSGS = [
    "Good luck guys, awesome idea, i support it",
    "Easy to use website and worked well.",
    "Thank you bhai!",
    "Keep it free for everyone ❤️",
    "Fast & clean. Respect.",
    "Saved me so much time.",
    "Ủng hộ team nhé!",
    "Cảm ơn vì trải nghiệm không quảng cáo.",
    "Nice work — simple & safe."
  ];
  const AMOUNTS = [50_000, 50_000, 50_000, 100_000, 100_000, 150_000, 200_000];

  const seedItems = [
    { name: "Somebody", days: 3, amount: 50_000, msg: "" },
    { name: "Somebody", days: 5, amount: 50_000, msg: "" },
    { name: "—", days: 7, amount: 100_000, msg: "" },
    { name: "Somebody", days: 7, amount: 50_000, msg: "" },
    { name: "Raghu", days: 8, amount: 50_000, msg: "Thank you bhai!" },
    { name: "Somebody", days: 11, amount: 50_000, msg: "" },
    { name: "Bori", days: 12, amount: 50_000, msg: "" },
    { name: "RC", days: 13, amount: 50_000, msg: "" },
    { name: "AB", days: 13, amount: 50_000, msg: "" },
    { name: "Omar", days: 14, amount: 100_000, msg: "Good luck guys, awesome idea, i support it" },
    { name: "HEUSC", days: 16, amount: 50_000, msg: "Easy to use website and worked well." }
  ];

  // Add synthetic entries (strong proof but not spammy)
  const synthCount = rand(5, 9);
  for (let i = 0; i < synthCount; i++) {
    seedItems.push({
      name: pick(NAMES),
      days: rand(1, 18),
      amount: pick(AMOUNTS),
      msg: Math.random() < 0.55 ? pick(MSGS) : ""
    });
  }
  seedItems.sort((a,b) => a.days - b.days);

  const feedList = $("feedList");
  const boardList = $("boardList");
  const lastUpdate = $("lastUpdate");
  const feedHint = $("feedHint");
  const boardHint = $("boardHint");
  const proofPill = $("proofPill");

  const avatarInitials = (name) => {
    const clean = (name || "S").replace(/[^a-zA-Z0-9À-ỹ\s]/g, "").trim();
    if (!clean) return "S";
    const parts = clean.split(/\s+/).slice(0,2);
    return parts.map(p => p[0]).join("").toUpperCase();
  };
  const dayLabel = (d) => d === 1 ? "1 day ago" : `${d} days ago`;

  const makeFeedItem = (it) => {
    const div = document.createElement("div");
    div.className = "item";

    const left = document.createElement("div");
    const right = document.createElement("div");
    right.className = "amt";
    right.textContent = fmtVND(it.amount);

    left.innerHTML = `
      <div class="who">${it.name}</div>
      <div class="when">${dayLabel(it.days)}</div>
      ${it.msg ? `<div class="msg">${it.msg}</div>` : ``}
    `;

    div.appendChild(left);
    div.appendChild(right);
    return div;
  };

  // Leaderboard
  const agg = new Map();
  for (const it of seedItems) {
    const key = it.name || "Somebody";
    agg.set(key, (agg.get(key) || 0) + (it.amount || 0));
  }
  const top = [...agg.entries()]
    .filter(([n]) => n !== "—")
    .sort((a,b) => b[1]-a[1])
    .slice(0, 5)
    .map(([name, total]) => ({ name, total }));

  const makeBoardItem = (it, idx) => {
    const div = document.createElement("div");
    div.className = "boardItem";
    const rank = idx + 1;

    div.innerHTML = `
      <div class="leftPack">
        <div class="avatar">${avatarInitials(it.name)}</div>
        <div class="nameBlock">
          <div class="nameLine">#${rank} • ${it.name}</div>
          <div class="subLine">Support total</div>
        </div>
      </div>
      <div class="amount">${fmtVND(it.total)}</div>
    `;
    return div;
  };

  if (feedList) {
    feedList.innerHTML = "";
    seedItems.slice(0, 6).forEach(it => feedList.appendChild(makeFeedItem(it)));
  }
  if (boardList) {
    boardList.innerHTML = "";
    top.forEach((it, idx) => boardList.appendChild(makeBoardItem(it, idx)));
  }

  // Counters
  const cntSupporters = $("cntSupporters");
  const cntWeek = $("cntWeek");
  const cntRaised = $("cntRaised");

  const uniqueSupporters = new Set(seedItems.map(x => x.name).filter(Boolean)).size;
  const supporters30 = uniqueSupporters + rand(22, 78);
  const tipsWeek = rand(14, 46);
  const raised = top.reduce((s, x) => s + x.total, 0) + rand(3_000_000, 12_000_000);

  const animateInt = (el, to) => {
    if (!el) return;
    const dur = 650;
    const t0 = performance.now();
    const step = (t) => {
      const p = Math.min(1, (t - t0) / dur);
      el.textContent = String(Math.floor(to * (1 - Math.pow(1-p, 3))));
      if (p < 1) requestAnimationFrame(step);
    };
    requestAnimationFrame(step);
  };

  const animateMoney = (el, to) => {
    if (!el) return;
    const dur = 750;
    const t0 = performance.now();
    const step = (t) => {
      const p = Math.min(1, (t - t0) / dur);
      el.textContent = fmtVND(Math.floor(to * (1 - Math.pow(1-p, 3))));
      if (p < 1) requestAnimationFrame(step);
    };
    requestAnimationFrame(step);
  };

  animateInt(cntSupporters, supporters30);
  animateInt(cntWeek, tipsWeek);
  animateMoney(cntRaised, raised);

  if (lastUpdate) {
    try {
      lastUpdate.textContent = `Updated ${new Date().toLocaleTimeString("vi-VN", { hour: "2-digit", minute: "2-digit" })}`;
    } catch (_) {
      lastUpdate.textContent = "Updated";
    }
  }
  if (feedHint) feedHint.textContent = "Live";
  if (boardHint) boardHint.textContent = "This month";
  if (proofPill) proofPill.textContent = "Live";

  // Goal micro-shift
  const goalPctEl = $("goalPct");
  const goalFill = $("goalFill");
  const basePct = 11;
  const micro = Math.random() < 0.55 ? rand(0, 1) : 0;
  const shownPct = basePct + micro;
  if (goalPctEl) goalPctEl.textContent = `${shownPct}%`;
  if (goalFill) goalFill.style.width = `${shownPct}%`;

  // Live toast (subtle)
  const toast = $("toast");
  const toastTxt = $("toastTxt");
  const showToast = (text) => {
    if (!toast || !toastTxt) return;
    toastTxt.textContent = text;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2800);
  };

  const toastTexts = [
    `${pick(NAMES)} just supported • ${rand(6,55)}s ago`,
    `${pick(NAMES)} gave support • ${rand(1,9)}m ago`,
    `Server costs covered by community • ${rand(6,18)}m ago`,
    `${pick(NAMES)} supported • ${rand(2,20)}h ago`
  ];

  const fireOnce = () => showToast(pick(toastTexts));
  setTimeout(fireOnce, rand(350, 900));
  setTimeout(fireOnce, rand(1200, 1800));

  setInterval(() => {
    if (document.visibilityState !== "visible") return;
    if (Math.random() < 0.35) showToast(pick(toastTexts));
  }, 9000);
})();
</script>
</body>
</html>
